<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>厂家任务</title>
		<script type="text/javascript" src="__PUBLIC__/kpi/jquery-2.1.1.js"></script>
		<script type="text/javascript" src="__PUBLIC__/kpi/table.js"></script>
		<link rel="stylesheet" type="text/css" href="/position/public/lib/Hui-iconfont/1.0.8/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="/position/public/lib/self_tip.css" />
		<script type="text/javascript" src="/position/public/lib/layer/2.4/layer.js"></script>
		<script type="text/javascript" src="/position/public/lib/pubjs.js"></script>

		<script type="text/javascript">
			$(document).ready(function() {
				var w = $(".table_box").width();
				var h = $(".table_box").height();
				$("#MyTable thead tr th").css({"padding":"3px","height":"25px"});
				$("table").css({"text-align":"center","font-size":"0.5rem","width":w,"height":h});
				$("table td").css({"padding":"0px","height":"20px"});
				FixTable("MyTable",  1, w, h);
			});
		</script>	
		<style>
			body{
				font-size: 62.5%;				
			}
                        table{border-collapse:collapse;}
			.table_box{
				width: 100%;
				height: 300px;
				margin: 0 auto;
				font-size: 0.5rem;
			}
                        .search_box{
				width: 100%;
				height: 40px;
				margin: 10px auto;
				border: 1px solid #eaeaea;
			}
			.select_box{
			    border: solid 1px #ddd;
			    box-sizing: border-box;
			    vertical-align: middle;
			    width: 250px;
			    padding: 4px 5px;
			    display: inline-block;
			    margin-top: 5px;
			    margin-left: 20px;
			    float: left;	
			    height: 30px;			
			}
			.select{
				border: 0;
				font-size: 14px;
				box-sizing: border-box;
			    cursor: pointer;
			    line-height: normal;
			    font-weight: normal;
			    width: 100%;
			    white-space: nowrap;
			    outline: none;				
			}
			.search_btn{
                background-color: #5a98de;
			    border-radius: 5px;
			    color: #FFFFFF;
			    float: left;
                display: inline-block;
			    box-sizing: border-box;
			    cursor: pointer;
			    text-align: center;
			    font-weight: 400;
			    white-space: nowrap;
			    vertical-align: middle;
			    -moz-padding-start: npx;
			    -moz-padding-end: npx;
			    width: auto;
			    border: none;
   				outline: none;
   				height: 30px;
   				margin-left: 20px;
   				margin-top: 5px;
   				padding: 0 10px;
			}
		</style>		
	</head>
	
	<body>
        <form action="{:Url('index')}" method="post">
            <div class="search_box">
				<div class="select_box">
							<select class="select" name="store_id" id="store_id">
								<?php $res = get_comlist(); foreach($res as $k => $v){  ?>
								<option value="<?php echo $v['ID']; ?>"><?php echo $v['NAME']; ?></option>
								<?php } ?>
							</select>
				</div>
				<button name="" id="" class="search_btn" type="submit"> 查询</button>
				<input type="hidden" id="table_name" value="vendor">
				<?php $clear_button = session("clear_button"); if($clear_button == "1"){ echo '<button name="" id="clear_button" style="background-color:orange;" class="search_btn" type="button" onclick="clearbutton()">清空数据</button>';} ?>
				<!--审批状态-->
				<?php foreach ($data_status['update_list'] as $key => $value) { ?>
				<input type="hidden" id="<?php echo 'status'.$key; ?>" value="<?php echo  $value; ?>" class="status">
				<?php } ?>
				<!--审批状态-->
			</div>
	</form>

		<h1 style="width:100%;text-align: center;"><span></span>厂家任务{:is_pass($data_status['status_list'])}</h1>
		<div class="table_box">
			<table border="1" bordercolor="#ddd" cellpadding="0" cellspacing="0" id="MyTable">
				<thead>
					<tr>
						<th rowspan="2"><div style="width: 100px;">车型分类</div></th>
						<th colspan="3">季度（Q1）</th>
						<th colspan="3">季度（Q2）</th>
						<th colspan="3">季度（Q3）</th>
						<th colspan="3">季度（Q4）</th>
						<th colspan="3">1月</th>
						<th colspan="3">2月</th>
						<th colspan="3">3月</th>
						<th colspan="3">4月</th>
						<th colspan="3">5月</th>
						<th colspan="3">6月</th>
						<th colspan="3">7月</th>
						<th colspan="3">8月</th>
						<th colspan="3">9月</th>
						<th colspan="3">10月</th>
						<th colspan="3">11月</th>
						<th colspan="3">12月</th>
						<th colspan="3">年度</th>
					</tr>
					<tr>
						<th><div style="width: 80px;">季度考核任务</div></th>
						<th><div style="width: 80px;">季度累计完成</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">季度考核任务</div></th>
						<th><div style="width: 80px;">季度累计完成</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">季度考核任务</div></th>
						<th><div style="width: 80px;">季度累计完成</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">季度考核任务</div></th>
						<th><div style="width: 80px;">季度累计完成</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
						<th><div style="width: 80px;">本月厂家任务</div></th>
						<th><div style="width: 80px;">本月实际完成销量</div></th>
						<th><div style="width: 80px;">达成率</div></th>
                        <th><div style="width: 80px;">年度考核任务</div></th>
						<th><div style="width: 80px;">年度累计完成</div></th>
						<th><div style="width: 80px;">达成率</div></th>
					</tr>
				</thead>
				
				<tbody>
                                    <?php $total = array(); ?>
                                    {foreach $data_list as $k => $v}
					<tr>
                                            <td>{$k}</td>
                                            {for start="1" end="5"}
                                            <td>
                                                <?php if(!empty($v[$i."|task"])){
                                                echo $v[$i."|task"];
                                                if(!isset($total[$i."|task"])){
                                                    $total[$i."|task"] = 0;
                                                }
                                                $total[$i."|task"] += $v[$i."|task"];
                                                }
                                                
                                                ?>
                                            </td>
                                            <td>
                                                <?php if(!empty($v[$i."|actual"])){
                                                echo $v[$i."|actual"];
                                                if(!isset($total[$i."|actual"])){
                                                    $total[$i."|actual"] = 0;
                                                }$total[$i."|actual"] += $v[$i."|actual"];
                                                } ?>
                                                
                                            </td>
                                            <td>
                                                <?php if(!empty($v[$i."|rate"])){
                                                echo ($v[$i."|rate"]*100)."%";
                                                } ?>
                                            </td>
                                            {/for}
                                            {for start="1" end="13"}
                                            <td class="info{$i}" data-order="<?php if(isset($data_id[$k][$year.'-'.$i.'|task'])) echo $data_id[$k][$year.'-'.$i.'|task']; ?>" data-key="task" data-type="float">
                                                <?php if(!empty($v[$year."-".$i."|task"])){
                                                echo $v[$year."-".$i."|task"];
                                                if(!isset($total[$year."-".$i."|task"])){
                                                    $total[$year."-".$i."|task"]=0;
                                                }$total[$year."-".$i."|task"] += $v[$year."-".$i."|task"];
                                                } 
                                                ?>
                                            </td>
                                            <td class="info{$i}" data-order="<?php if(isset($data_id[$k][$year.'-'.$i.'|task'])) echo $data_id[$k][$year.'-'.$i.'|actual']; ?>" data-key="actual" data-type="float">
                                                <?php if(!empty($v[$year."-".$i."|actual"])){
                                                echo $v[$year."-".$i."|actual"];
                                                if(!isset($total[$year."-".$i."|actual"])){
                                                    $total[$year."-".$i."|actual"] = 0;
                                                }$total[$year."-".$i."|actual"] += $v[$year."-".$i."|actual"];
                                                }
                                                
                                                ?>
                                            </td>
                                            <td>
                                                <?php if(!empty($v[$year."-".$i."|rate"])){
                                                echo ($v[$year."-".$i."|rate"]*100)."%";
                                                } ?>
                                            </td>
                                            {/for}
                                            <td>
                                                <?php if(!empty($v["year|task"])){
                                                echo $v["year|task"];
                                                if(!isset($total["year|task"])){
                                                    $total["year|task"]=0;
                                                }$total["year|task"] += $v["year|task"];
                                                }
                                                ?>
                                            </td>
                                            <td>
                                                <?php if(!empty($v["year|actual"])){
                                                echo $v["year|actual"];
                                                if(!isset($total["year|actual"])){
                                                    $total["year|actual"] = 0;
                                                }$total["year|actual"] += $v["year|actual"];
                                                }
                                                ?>
                                            </td>
                                            <td>
                                                <?php if(!empty($v["year|rate"])){
                                                echo ($v["year|rate"]*100)."%";
                                                } ?>
                                            </td>
					</tr>
				    {/foreach}
                                    <tr style="background-color: darkseagreen;">
                                        <td>合计</td>
                                        {for start="1" end="5"}
                                        <td>
                                            <?php if(!empty($total[$i."|task"])){
                                                  echo  $total[$i."|task"];
                                            }?>
                                        </td>
                                        <td>
                                            <?php if(!empty($total[$i."|actual"])){
                                                  echo $total[$i."|actual"] ;
                                            }?>
                                        </td>
                                        <td>
                                            <?php if(!empty($total[$i."|task"]) && !empty($total[$i."|actual"])){
                                            echo (round($total[$i."|actual"]/$total[$i."|task"],2)*100)."%";
                                            }?>
                                        </td>
                                        {/for}
                                        {for start="1" end="13"}
                                        <td>
                                            <?php if(!empty($total[$year."-".$i."|task"])){
                                                  echo $total[$year."-".$i."|task"];
                                            }?>
                                        </td>
                                        <td>
                                            <?php if(!empty($total[$year."-".$i."|actual"])){
                                                  echo $total[$year."-".$i."|actual"];
                                            }?>
                                        </td>
                                        <td>
                                            <?php if(!empty($total[$year."-".$i."|task"]) && !empty($total[$year."-".$i."|actual"])){
                                            echo (round($total[$year."-".$i."|actual"]/$total[$year."-".$i."|task"],2)*100)."%";
                                            }?>
                                        </td>
                                        {/for}
                                        <td>
                                            <?php if(!empty($total["year|task"])){
                                               echo $total["year|task"];
                                            }?>
                                        </td>
                                        <td>
                                            <?php if(!empty($total["year|actual"])){
                                               echo $total["year|actual"];
                                            }?>
                                        </td>
                                        <td>
                                            <?php if(!empty($total["year|task"]) && !empty($total["year|actual"])){
                                            echo (round($total["year|actual"]/$total["year|task"],2)*100)."%";
                                            }?>
                                        </td>
                                    </tr>
				</tbody>				
			</table>
		</div>
                <input type="hidden" value="<?php if(!empty($sid)) echo $sid; ?>" id="search_id"/>


	</body>
        <script>
              $(document).ready(function(){
					var store_id = $("#search_id").val();
					if (store_id != "") {
						$("#store_id").val(store_id);
					};
				  var store_name = $("#store_id").find("option:selected").text();
				  $("h1 > span").eq(0).html(store_name);
              });
              $(function(){
				  $(".status").each(function(){       //查找状态为2的情况，添加修改功能
					  var status  = $(this).val();
					  if(status == 2){
						  var edit_month = $(this).attr("id").substring(6,7);
						  if(edit_month == '1'){
							  $(".info1").addClass('edit');
						  }else{
							  var last_month = Number(edit_month)-1;
							  $(".info"+edit_month).addClass('edit');
						  }
					  }
				  });

                  //修改
                var self;
                var status = $("#status").val();
                   $("#MyTable td.edit").hover(
						function(){
							$(this).css({"cursor":"url(/position/public/kpi/img/edit.png),default","background-color":"#eee"});
						},
						function(){
							$(this).css({"cursor":"default","background-color":"#fff"});
						}
                    );
                $("#MyTable td.edit").on("dblclick",function(){
                    self = $(this);
                    var con = self.html();			//所点击要修改的原内容
                    var table_name = 'task';			//所点击要修改的表名
                    var key_name = self.attr("data-key");	//所点击要修改的键名
                    var order_num = self.attr("data-order");	//所点击要修改的序号id
                    var datatype = self.attr("data-type");	//此处是何种类型格式
					tip_function(datatype,table_name,key_name,con,1,order_num);
                    });
              }); 
        </script>
</html>
